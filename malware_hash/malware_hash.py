#!/usr/bin/env python

import json
import os


class MalwareHash(object):
    def __init__(self, hash_func, json_files=None):
        self.hash_func = hash_func
        self.computed_hashes = {}

        if json_files is None:
            dir_name = os.path.dirname(os.path.abspath(__file__))
            json_files = [os.path.join(dir_name, file) for file in os.listdir(dir_name) if file.endswith('.json')]

        for json_file in json_files:
            self.load_hash_sources(json_file)

    def load_hash_sources(self, filename):
        with open(filename, 'r') as f:
            for values in json.load(f).values():
                for input_string in values:
                    computed_hash = self.hash_func(input_string)
                    hash_set = self.computed_hashes.get(computed_hash)
                    if not hash_set:
                        hash_set = set()
                        self.computed_hashes[computed_hash] = hash_set
                    hash_set.add(input_string)

    def get_strings_by_hash(self, computed_hash):
        return list(self.computed_hashes.get(computed_hash, set()))
